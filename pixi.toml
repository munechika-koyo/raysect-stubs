[workspace]
channels = ["https://prefix.dev/conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64"]
preview = ["pixi-build"]

# -------------------------------
# === Packaging Configuration ===
# -------------------------------
[package]
version = "dynamic" # Until pixi recommends something else

[package.build]
backend = { name = "pixi-build-python", version = "*" }

[package.build.config]
noarch = true

[package.host-dependencies]
uv = "*"
python = ">=3.10"
hatchling = "*"
hatch-vcs = "*"

# ---------------------------------
# === Development Configuration ===
# ---------------------------------
[dependencies]
raysect-stubs = { path = "." }
raysect = "*"
pytest = "*"
mypy = "*"

[tasks]
# Testing and type checking
test = "pytest tests/"
type-check = "mypy raysect-stubs/"

# Type stub generation
typegen = { cmd = [
  "stubgen",
  "-p",
  "raysect",
  "-o",
  "stubgen_temp",
  "--ignore-errors",
  "--include-private",
  "--include-docstrings",
], description = "ğŸ“ Generate type stubs for raysect" }

typegen-update = { cmd = [
  "rm",
  "-rf",
  "src/raysect-stubs/*",
  "&&",
  "mv",
  "stubgen_temp/raysect/*",
  "src/raysect-stubs/",
], description = "ğŸ“ Update type stubs for raysect" }

# === Linting feature ===
[feature.lint.dependencies]
dprint = "*"
lefthook = "*"
ruff = "*"
typos = "*"
mypy = "*"
pyrefly = "*"
actionlint = "*"
shellcheck = "*"
validate-pyproject = "*"
blacken-docs = "*"
taplo = "*"

[feature.lint.tasks]
lefthook = { cmd = "lefthook", description = "ğŸ”— Run lefthook" }
hooks = { cmd = "lefthook install", description = "ğŸ”— Install pre-commit hooks" }
pre-commit = { cmd = "lefthook run pre-commit", description = "ğŸ”— Run pre-commit checks" }
mypy = { cmd = "mypy", description = "Type check with mypy" }
pyrefly = { cmd = "pyrefly check", description = "Type check with pyrefly" }
ruff-check = { cmd = "ruff check --fix", description = "Lint with ruff" }
ruff-format = { cmd = "ruff format", description = "Format with ruff" }
dprint = { cmd = "dprint fmt", description = "Format with dprint" }
typos = { cmd = "typos --write-changes --force-exclude", description = "Fix typos" }
taplo = { cmd = "taplo fmt", description = "Format toml files with taplo" }
actionlint = { cmd = "actionlint", description = "Lint actions with actionlint" }
blacken-docs = { cmd = "blacken-docs", description = "Format Python markdown blocks with Black" }
validate-pyproject = { cmd = "validate-pyproject pyproject.toml", description = "Validate pyproject.toml" }
lint = { cmd = "lefthook run pre-commit --all-files --force", description = "ğŸ§¹ Run all linters" }

# === Python environment features ===
[feature.py310.dependencies]
python = "3.10.*"
[feature.py313.dependencies]
python = "3.13.*"

[environments]
default = { features = ["py313"], solve-group = "py313" }
py313 = { features = ["py313"], solve-group = "py313" }   # alias of test
py310 = { features = ["py310"], solve-group = "py310" }
lint = { features = ["lint"], no-default-feature = true }
